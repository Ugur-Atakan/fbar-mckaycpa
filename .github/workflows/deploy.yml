name: Deploy Vite Build to Production Branch

on:
  push:
    branches:
      - main  # Eğer main branch'e push olduğunda çalışmasını istiyorsan

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Kodu Checkout Et
        uses: actions/checkout@v3

      - name: Node.js Kurulumu
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Bağımlılıkları Kur ve Build Al
        run: |
          npm install
          npm run build

      - name: Production Branch’ini Güncelle
        run: |
          git config --global user.name "${{ github.actor }}"  
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"
          
          git fetch origin production  # Production branch’ini al
          git checkout production  # Branch'e geç
          
          # Eğer dist klasörü yoksa hata verme
          if [ ! -d "dist" ]; then
            echo "❌ Build klasörü bulunamadı! Vite build işlemi başarısız oldu mu?"
            exit 1
          fi
          
          rm -rf *  # Eski build dosyalarını temizle (Eğer diğer dosyaları korumak istiyorsan kaldır)
          mv dist/* .  # Yeni build dosyalarını taşı
          rm -rf dist  # dist klasörünü temizle
          
          git add .
          git commit -m "Güncellenmiş Vite Build - $(date)"
          git push origin production

